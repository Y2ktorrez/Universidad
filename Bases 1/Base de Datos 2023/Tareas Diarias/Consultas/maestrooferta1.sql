CREATE DATABASE MAESTROOFERTAS2_2023;
USE MAESTROOFERTAS2_2023;

CREATE TABLE MATERIA
(
	SIGLA varchar(6) NOT NULL PRIMARY KEY,
    NOMBRE VARCHAR(60) NOT NULL
);


CREATE TABLE DOCENTE 
(
	CODIGO INTEGER NOT NULL PRIMARY KEY,
	NOMBRE VARCHAR(60) NOT NULL
);


CREATE TABLE PERIODO
(
	ID  INTEGER NOT NULL PRIMARY KEY,
    NUMERO  tinyint NOT NULL,
    AÑO  SMALLINT NOT NULL
);

CREATE TABLE GRUPO
(
	ID INTEGER NOT NULL PRIMARY KEY,
    NOMBRE VARCHAR(2) NOT NULL,
    SIGLAMATERIA varchar(6) NOT NULL,
    CODOCENTE INTEGER NOT NULL,
	IDPERIODO INTEGER NOT NULL,
	foreign key (SIGLAMATERIA) references MATERIA(SIGLA)
	   ON UPDATE CASCADE
	   ON DELETE CASCADE,
    foreign key (CODOCENTE) references DOCENTE(CODIGO)
	  ON UPDATE CASCADE
	  ON DELETE CASCADE,
    foreign key (IDPERIODO) references PERIODO(ID)
	  ON UPDATE CASCADE
	  ON DELETE CASCADE
);

CREATE TABLE HORARIO
(
	IDGRUPO INTEGER NOT NULL,
	ID tinyint NOT NULL, 
    DIA VARCHAR(9) NOT NULL,
    HORAI time NOT NULL,
    HORAF time NOT NULL,
	PRIMARY KEY (IDGRUPO, ID),
	foreign key (IDGRUPO) references GRUPO(ID)
	ON UPDATE CASCADE
	ON DELETE CASCADE
);

CREATE TABLE ALUMNO(
	REGISTRO INT NOT NULL PRIMARY KEY,
    NOMBRE VARCHAR(60)
);

CREATE TABLE BOLETAINSCRIPCION(
	NRO INT NOT NULL PRIMARY KEY,
    FECHA DATE,
    HORA TIME,
    REGALUMNO INT NOT NULL,
    FOREIGN KEY(REGALUMNO) REFERENCES ALUMNO(REGISTRO)
		ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE INSCRIBE(
	NROBOLETA INT NOT NULL,
    IDGRUPO INTEGER NOT NULL,
    PRIMARY KEY(NROBOLETA, IDGRUPO),
    FOREIGN KEY(NROBOLETA) REFERENCES BOLETAINSCRIPCION(NRO)
		ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY(IDGRUPO) REFERENCES GRUPO(ID)
		ON DELETE CASCADE ON UPDATE CASCADE
);

-- Insert
-- MATERIAS 
INSERT INTO MATERIA VALUES ('FIS100','FISICA I');
INSERT INTO MATERIA VALUES ('INF110','INTRODUCCION A LA INFORMATICA');
INSERT INTO MATERIA VALUES ('INF119','ESTRUCTURAS DISCRETAS');
INSERT INTO MATERIA VALUES ('LIN100','INGLES TECNICO I');
INSERT INTO MATERIA VALUES ('MAT101','CALCULO I');
INSERT INTO MATERIA VALUES ('FIS102','FISICA II');
INSERT INTO MATERIA VALUES ('INF120','PROGRAMACION I');
INSERT INTO MATERIA VALUES ('MAT102','CALCULO II');
INSERT INTO MATERIA VALUES ('MAT103','ALGEBRA LINEAL');
INSERT INTO MATERIA VALUES ('FIS200','FISICA III');
INSERT INTO MATERIA VALUES ('INF210','PROGRAMACION II');
INSERT INTO MATERIA VALUES ('MAT207','ECUACIONES DIFERENCIALES');
INSERT INTO MATERIA VALUES ('INF220','ESTRUCTURA DE DATOS I');

-- DOCENTE
INSERT INTO DOCENTE VALUES (100,'SALAZAR PEREZ TOMAS ALBERTO');
INSERT INTO DOCENTE VALUES (101,'VEIZAGA GONZALES JOSUE OBED');
INSERT INTO DOCENTE VALUES (102,'JUAN CARLOS CONTRERAS');
INSERT INTO DOCENTE VALUES (103,'CACERES CHACON BRAULIO');
INSERT INTO DOCENTE VALUES (104,'GUTIERREZ BRUNO KATIME ESTHER');
INSERT INTO DOCENTE VALUES (105,'GUZMAN MOLINA ISABEL MIRIAM');
INSERT INTO DOCENTE VALUES (106,'ZUÑIGA RUIZ WILMA');
INSERT INTO DOCENTE VALUES (107,'VALDELOMAR ORELLANA TOMAS');
INSERT INTO DOCENTE VALUES (108,'MIRANDA CARRASCO CARLOS');
INSERT INTO DOCENTE VALUES (109,'ZEBALLOS PAREDES DANIEL LUIS');
INSERT INTO DOCENTE VALUES (110,'PEINADO PEREIRA MIGUEL JESUS');
INSERT INTO DOCENTE VALUES (111,'MOLLO MAMANI ALBERTO');
INSERT INTO DOCENTE VALUES (112,'LAZO ARTEAGA CARLOS ROBERTO');
INSERT INTO DOCENTE VALUES (113,'CORTEZ UZEDA JULIO MARTIN');
INSERT INTO DOCENTE VALUES (114,'ROSALES FUENTES JORGE MARCELO');
INSERT INTO DOCENTE VALUES (115,'AVENDAÑO GONZALES EUDAL');
INSERT INTO DOCENTE VALUES (116,'CAMPOS BARRERA MARIO');

-- PERIODO
INSERT INTO PERIODO VALUES (1,2,2023);

-- GRUPO
INSERT INTO GRUPO VALUES (1,'Z6','FIS100',100,1);
INSERT INTO GRUPO VALUES (2,'SI','INF110',101,1);
INSERT INTO GRUPO VALUES (3,'SZ','INF110',102,1);
INSERT INTO GRUPO VALUES (4,'Z2','INF119',103,1);
INSERT INTO GRUPO VALUES (5,'SK','INF119',104,1);
INSERT INTO GRUPO VALUES (6,'NX','LIN100',105,1);
INSERT INTO GRUPO VALUES (7,'Z3','LIN100',106,1);
INSERT INTO GRUPO VALUES (8,'Z4','MAT101',107,1);
INSERT INTO GRUPO VALUES (9,'Z3','MAT101',108,1);
INSERT INTO GRUPO VALUES (10,'BI','FIS102',109,1);
INSERT INTO GRUPO VALUES (11,'NW','FIS102',109,1);
INSERT INTO GRUPO VALUES (12,'SH','INF120',110,1);
INSERT INTO GRUPO VALUES (13,'SI','INF120',111,1);
INSERT INTO GRUPO VALUES (14,'SB','MAT102',112,1);
INSERT INTO GRUPO VALUES (15,'SA','MAT103',113,1);
INSERT INTO GRUPO VALUES (16,'SB','MAT103',113,1);
INSERT INTO GRUPO VALUES (17,'SC','MAT103',113,1);
INSERT INTO GRUPO VALUES (18,'SD','MAT103',113,1);
INSERT INTO GRUPO VALUES (19,'SA','INF210',102,1);
INSERT INTO GRUPO VALUES (20,'SB','INF210',102,1);
INSERT INTO GRUPO VALUES (21,'SC','INF210',102,1);
INSERT INTO GRUPO VALUES (22,'SC','FIS200',114,1);
INSERT INTO GRUPO VALUES (23,'SC','MAT207',115,1);
INSERT INTO GRUPO VALUES (24,'SB','INF220',116,1);

-- HORARIOS
INSERT INTO HORARIO VALUES (1,1,'LUNES','10:00','11:30');
INSERT INTO HORARIO VALUES (1,2,'MIERCOLES','10:00','11:30');
INSERT INTO HORARIO VALUES (1,3,'VIERNES','10:00','11:30');
INSERT INTO HORARIO VALUES (1,4,'SABADO','18:15','19:45');
INSERT INTO HORARIO VALUES (2,1,'MARTES','09:15','11:30');
INSERT INTO HORARIO VALUES (2,2,'JUEVES','09:15','11:30');
INSERT INTO HORARIO VALUES (3,1,'LUNES','07:00','08:30');
INSERT INTO HORARIO VALUES (3,2,'MIERCOLES','07:00','08:30');
INSERT INTO HORARIO VALUES (3,3,'VIERNES','07:00','08:30');
INSERT INTO HORARIO VALUES (4,1,'LUNES','08:30','10:00');
INSERT INTO HORARIO VALUES (4,2,'MIERCOLES','08:30','10:00');
INSERT INTO HORARIO VALUES (4,3,'VIERNES','08:30','10:00');
INSERT INTO HORARIO VALUES (5,1,'MARTES','07:00','09:15');
INSERT INTO HORARIO VALUES (5,2,'JUEVES','07:00','09:15');
INSERT INTO HORARIO VALUES (6,1,'MARTES','07:00','09:15');
INSERT INTO HORARIO VALUES (6,2,'JUEVES','07:00','09:15');
INSERT INTO HORARIO VALUES (7,1,'MARTES','13:45','16:00');
INSERT INTO HORARIO VALUES (7,2,'JUEVES','13:45','16:00');
INSERT INTO HORARIO VALUES (8,1,'MARTES','13:45','16:00');
INSERT INTO HORARIO VALUES (8,2,'JUEVES','13:45','16:00');
INSERT INTO HORARIO VALUES (9,1,'MARTES','16:00','18:15');
INSERT INTO HORARIO VALUES (9,2,'JUEVES','16:00','18:15');
INSERT INTO HORARIO VALUES (10,1,'MARTES','07:00','09:15');
INSERT INTO HORARIO VALUES (10,2,'JUEVES','07:00','09:15');
INSERT INTO HORARIO VALUES (10,3,'VIERNES','18:15','19:45');
INSERT INTO HORARIO VALUES (11,1,'MARTES','18:15','20:30');
INSERT INTO HORARIO VALUES (11,2,'MIERCOLES','20:30','22:00');
INSERT INTO HORARIO VALUES (11,3,'JUEVES','18:15','20:30');
INSERT INTO HORARIO VALUES (12,1,'MARTES','16:00','18:15');
INSERT INTO HORARIO VALUES (12,2,'JUEVES','16:00','18:15');
INSERT INTO HORARIO VALUES (13,1,'LUNES','07:00','08:30');
INSERT INTO HORARIO VALUES (13,2,'MIERCOLES','07:00','08:30');
INSERT INTO HORARIO VALUES (13,3,'VIERNES','07:00','08:30');
INSERT INTO HORARIO VALUES (14,1,'MARTES','20:30','22:45');
INSERT INTO HORARIO VALUES (14,2,'JUEVES','20:30','22:45');
INSERT INTO HORARIO VALUES (15,1,'LUNES','08:30','10:00');
INSERT INTO HORARIO VALUES (15,2,'MIERCOLES','08:30','10:00');
INSERT INTO HORARIO VALUES (15,3,'VIERNES','08:30','10:00');
INSERT INTO HORARIO VALUES (16,1,'LUNES','10:00','11:30');
INSERT INTO HORARIO VALUES (16,2,'MIERCOLES','10:00','11:30');
INSERT INTO HORARIO VALUES (16,3,'VIERNES','10:00','11:30');
INSERT INTO HORARIO VALUES (17,1,'LUNES','07:00','08:30');
INSERT INTO HORARIO VALUES (17,2,'MIERCOLES','07:00','08:30');
INSERT INTO HORARIO VALUES (17,3,'VIERNES','07:00','08:30');
INSERT INTO HORARIO VALUES (18,1,'LUNES','11:30','13:00');
INSERT INTO HORARIO VALUES (18,2,'MIERCOLES','11:30','13:00');
INSERT INTO HORARIO VALUES (18,3,'VIERNES','11:30','13:00');
INSERT INTO HORARIO VALUES (19,1,'MARTES','13:45','16:00');
INSERT INTO HORARIO VALUES (19,2,'JUEVES','13:45','16:00');
INSERT INTO HORARIO VALUES (20,1,'MARTES','09:15','11:30');
INSERT INTO HORARIO VALUES (20,2,'JUEVES','09:15','11:30');
INSERT INTO HORARIO VALUES (21,1,'MARTES','07:00','09:15');
INSERT INTO HORARIO VALUES (21,2,'JUEVES','07:00','09:15');
INSERT INTO HORARIO VALUES (22,1,'LUNES','15:15','16:45');
INSERT INTO HORARIO VALUES (22,2,'MIERCOLES','15:15','16:45');
INSERT INTO HORARIO VALUES (22,3,'VIERNES','15:15','16:45');
INSERT INTO HORARIO VALUES (22,4,'VIERNES','21:15','22:45');
INSERT INTO HORARIO VALUES (23,1,'MARTES','20:30','22:45');
INSERT INTO HORARIO VALUES (23,2,'JUEVES','20:30','22:45');
INSERT INTO HORARIO VALUES (24,1,'MARTES','20:30','22:45');
INSERT INTO HORARIO VALUES (24,2,'JUEVES','20:30','22:45');


INSERT INTO ALUMNO VALUES (1111,'JOAQUIN CHUMACERO');
INSERT INTO ALUMNO VALUES (2222,'SATURDINO MAMANI');
INSERT INTO ALUMNO VALUES (3333,'FABIOLA MENDEZ');
INSERT INTO ALUMNO VALUES (4444,'PABLO CHUMACEIRO');	
INSERT INTO ALUMNO VALUES (5555,'ANDRES SCHUMACHER');
INSERT INTO ALUMNO VALUES (6666,'FABIANA YUPANKI');

/* INSERTAR BOLETA INSCRIPCION*/
INSERT INTO BOLETAINSCRIPCION VALUES(100,'2023-10-22','09:00',1111);
INSERT INTO BOLETAINSCRIPCION VALUES(101,'2023-10-27','09:00',2222);
INSERT INTO BOLETAINSCRIPCION VALUES(102,'2023-10-27','09:00',3333);
INSERT INTO BOLETAINSCRIPCION VALUES(103,'2023-11-1','09:00',4444);
INSERT INTO BOLETAINSCRIPCION VALUES(104,'2023-11-1','09:00',5555);
INSERT INTO BOLETAINSCRIPCION VALUES(105,'2023-11-2','09:00',6666);

/* INSERTAR INSCRIBE*/

INSERT INTO INSCRIBE VALUES(100,1);
INSERT INTO INSCRIBE VALUES(100,4);
INSERT INTO INSCRIBE VALUES(100,5);
INSERT INTO INSCRIBE VALUES(100,11);	
INSERT INTO INSCRIBE VALUES(100,15);



-- CONSULTAS

-- MOSTRAR LOS GRUPOS DE LA MATERIA PROGRAMACION II, EN EL SEMESTRE 2023
SELECT GRUPO.ID, GRUPO.NOMBRE
FROM MATERIA, GRUPO, PERIODO
WHERE SIGLA=SIGLAMATERIA AND IDPERIODO=PERIODO.ID AND MATERIA.NOMBRE= 'PROGRAMACION II'
      AND PERIODO.NUMERO=2 AND PERIODO.AÑO=2023;

SELECT ID, NOMBRE
FROM GRUPO
WHERE SIGLAMATERIA IN (SELECT SIGLA
						FROM MATERIA
                        WHERE MATERIA.NOMBRE= 'PROGRAMACION II'
						)
                   AND IDPERIODO IN (SELECT ID 
									 FROM PERIODO
									 WHERE NUMERO=2 AND AÑO=2023
                                     );

-- MOSTRAR LA CANTIDA DE GRUPOS DE LA MATERIA PROGRAMACION II, EN EL SEMESTRE 2023
SELECT COUNT(*) AS CANTIDAD
FROM MATERIA, GRUPO, PERIODO
WHERE SIGLA=SIGLAMATERIA AND IDPERIODO=PERIODO.ID AND MATERIA.NOMBRE= 'PROGRAMACION II'
      AND PERIODO.NUMERO=2 AND PERIODO.AÑO=2023;

SELECT COUNT(*) AS CANTIDAD
FROM GRUPO
WHERE SIGLAMATERIA IN (SELECT SIGLA
						FROM MATERIA
                        WHERE MATERIA.NOMBRE= 'PROGRAMACION II'
						)
                   AND IDPERIODO IN (SELECT ID 
									 FROM PERIODO
									 WHERE NUMERO=2 AND AÑO=2023
                                     );
                                     
-- MOSTRAR POR CADA MATERIA LA CANTIDAD DE GRUPOS EN EL SEMESTRE 2-2023
SELECT MATERIA.SIGLA, MATERIA.NOMBRE, COUNT(*)
FROM MATERIA, GRUPO, PERIODO
WHERE SIGLA=SIGLAMATERIA AND IDPERIODO=PERIODO.ID 
      AND PERIODO.NUMERO = 2 AND PERIODO.AÑO = 2023
GROUP BY MATERIA.SIGLA, MATERIA.NOMBRE;

-- MOSTRAR LAS MATERIAS QUE TIENEN MAS DE DOS GRUPOS 
SELECT MATERIA.SIGLA, MATERIA.NOMBRE, COUNT(*)
FROM MATERIA, GRUPO, PERIODO
WHERE SIGLA=SIGLAMATERIA AND IDPERIODO=PERIODO.ID 
      AND PERIODO.NUMERO = 2 AND PERIODO.AÑO = 2023
GROUP BY MATERIA.SIGLA, MATERIA.NOMBRE
HAVING COUNT(*) > 2; -- SIRVE COMO UN WHERE DENTRO DEL GROUP BY, ES UNA CONDICION AL RESULTADO DE GROUP BY

-- MOSTRAR LAS MATERIAS QUE ENSEÑA EL DOCENTE 'ZEBALLOS PAREDES DANIEL LUIS' EN EL SEMESTRE 2-2023
SELECT DISTINCT MATERIA.SIGLA, MATERIA.NOMBRE
FROM MATERIA , GRUPO , DOCENTE , PERIODO 
WHERE GRUPO.SIGLAMATERIA = MATERIA.SIGLA AND GRUPO.CODOCENTE = DOCENTE.CODIGO
	  AND GRUPO.IDPERIODO = PERIODO.ID AND DOCENTE.NOMBRE = 'ZEBALLOS PAREDES DANIEL LUIS'
      AND PERIODO.NUMERO = 2 AND PERIODO.AÑO = 2023;

-- OTRA FORMA
SELECT DISTINCT MATERIA.NOMBRE
FROM DOCENTE,MATERIA,GRUPO,PERIODO
WHERE DOCENTE.CODIGO=	GRUPO.CODOCENTE AND GRUPO.SIGLAMATERIA=MATERIA.SIGLA AND DOCENTE.NOMBRE='ZEBALLOS PAREDES DANIEL LUIS'
AND PERIODO.NUMERO=2 AND PERIODO.AÑO=2023;

-- MOSTRAR POR CADA GRUPO LA CANTIDAD DE HORARIOS QUE TIENE
SELECT GRUPO.ID, GRUPO.NOMBRE, COUNT(*) 
FROM  GRUPO, HORARIO, PERIODO
WHERE GRUPO.ID = IDGRUPO AND PERIODO.NUMERO = 2 AND PERIODO.AÑO = 2023
GROUP BY GRUPO.ID, GRUPO.NOMBRE;

-- Forma del ing 
SELECT IDGRUPO, GRUPO.NOMBRE, COUNT(*) AS HORARIO
FROM  GRUPO, HORARIO
WHERE GRUPO.ID = IDGRUPO 
GROUP BY IDGRUPO, GRUPO.NOMBRE;

-- Mostrar el Id del grupo, Nombre del grupo y sigla, de aquellas materias, que inscribio JOAQUIN CHUMACERO en el semestre 2-2023
SELECT GRUPO.ID, GRUPO.NOMBRE, GRUPO.SIGLAMATERIA
FROM ALUMNO, BOLETAINSCRIPCION, INSCRIBE, GRUPO, PERIODO
WHERE REGISTRO = REGALUMNO AND NRO=NROBOLETA AND IDGRUPO=GRUPO.ID AND GRUPO.ID AND GRUPO.IDPERIODO = PERIODO.ID
      AND ALUMNO.NOMBRE = 'JOAQUIN CHUMUCERO' AND NUMERO = 2 AND AÑO=2023; -- la idea es esta.
      
-- Mostrar la cantidad de materias que inscribio JOAQUIN CHUMACERO en el semestre 2-2023
SELECT count(*) -- * es la Fila, el valor de SIGLAMATERIA tambien cuenta los valores.
FROM ALUMNO, BOLETAINSCRIPCION, INSCRIBE, GRUPO, PERIODO
WHERE REGISTRO = REGALUMNO AND NRO=NROBOLETA AND IDGRUPO=GRUPO.ID AND GRUPO.ID AND GRUPO.IDPERIODO = PERIODO.ID
      AND ALUMNO.NOMBRE = 'JOAQUIN CHUMUCERO' AND NUMERO = 2 AND AÑO=2023;
      
-- Mostrar la cantidad de materias que inscribio cada alumno del semestre 2-2023
SELECT REGISTRO, ALUMNO.NOMBRE, COUNT(*)
FROM ALUMNO, BOLETAINSCRIPCION, INSCRIBE, GRUPO, MATERIA, PERIODO
WHERE REGISTRO = REGALUMNO AND NRO=NROBOLETA AND IDGRUPO=GRUPO.ID AND GRUPO.ID AND GRUPO.IDPERIODO = PERIODO.ID AND
      GRUPO.SIGLAMATERIA =  MATERIA.SIGLA  AND NUMERO = 2 AND AÑO = 2023
GROUP BY REGISTRO, ALUMNO.NOMBRE ;

SELECT REGISTRO, ALUMNO.NOMBRE, count(*) -- * es la Fila, el valor de SIGLAMATERIA tambien cuenta los valores.
FROM ALUMNO, BOLETAINSCRIPCION, INSCRIBE, GRUPO, PERIODO
WHERE REGISTRO = REGALUMNO AND NRO=NROBOLETA AND IDGRUPO=GRUPO.ID AND GRUPO.ID AND GRUPO.IDPERIODO = PERIODO.ID
	  AND NUMERO = 2 AND AÑO=2023
GROUP BY   REGISTRO, ALUMNO.NOMBRE;

-- Mostrar todas las materias que no han sido progamadas en el semestre 2-2023
SELECT SIGLA, NOMBRE
FROM MATERIA
WHERE SIGLA NOT IN (SELECT SIGLAMATERIA    -- para negar not null
					FROM GRUPO
                    WHERE IDPERIODO IN (SELECT ID
											FROM PERIODO
                                            WHERE NUMERO = 2 AND  AÑO=2023)
					);
	  
-- Mostrar los alumnos inscritos que han inscrito 4 o mas materias en el semestre 2-2023
SELECT REGISTRO, ALUMNO.NOMBRE, count(*) -- * es la Fila, el valor de SIGLAMATERIA tambien cuenta los valores.
FROM ALUMNO, BOLETAINSCRIPCION, INSCRIBE, GRUPO, PERIODO
WHERE REGISTRO = REGALUMNO AND NRO=NROBOLETA AND IDGRUPO=GRUPO.ID AND GRUPO.ID AND GRUPO.IDPERIODO = PERIODO.ID
	  AND NUMERO = 2 AND AÑO=2023
GROUP BY   REGISTRO, ALUMNO.NOMBRE
HAVING COUNT(SIGLAMATERIA)>=4; 